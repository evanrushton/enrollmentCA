---
title: "EL Exploration"
author: "Evan Rushton"
date: "11/9/2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
setwd("~/R-projects/enrollmentCA")
EL_enrollments <- fread("./Transformed_Data/CA/el.csv", header=TRUE)
```

# Top English Learner Languages
  
Looking at the 2017-2018 school year, Spanish is the dominant language with over 1M speakers. Followed by Vietnamese with ~27k, Mandarin with ~22k, and Arabic rounding out the top four at 19k speakers.
  
```{r}
#bars
DTel %>% 
    filter(YEAR == "2017") %>%
    group_by(LANGUAGE) %>% 
    summarize(total = sum(TOTAL)) %>% 
    mutate(LANGUAGE = fct_reorder(LANGUAGE, total)) %>% 
    arrange(desc(total)) %>% 
    head(17) %>% 
    ggplot(aes(LANGUAGE, total, na.rm=T)) +
    geom_col() +
    coord_flip() 

#table
DTel %>% 
    filter(YEAR == "2017") %>%
    group_by(LANGUAGE) %>% 
    summarize(total = sum(TOTAL) )%>% 
    arrange(desc(total)) %>% 
    mutate(LANGUAGE = fct_reorder(LANGUAGE, total)) 

#log-scale bars
DTel %>% 
    filter(YEAR == "2017") %>%
    group_by(LANGUAGE) %>% 
    summarize(total = sum(TOTAL)) %>% 
    filter(total > 3200) %>% 
    arrange(desc(total)) %>% 
    mutate(LANGUAGE = fct_reorder(LANGUAGE, total)) %>% 
    ggplot(aes(LANGUAGE, total, na.rm=T)) +
    scale_y_log10() +
    geom_col() +
    coord_flip()
```

# How have Languages Changed over time?

Interestingly, even though the number of Hispanic students continues to rise in our state, the number of Spanish speaking English Learners peaked in the early 2000s () and has dropped to levels seen in the mid 90s. This evidence supports the claim that English is becoming more dominant in the state and native Spanish speakers are on the decline.

```{r}
#line graph
DTel %>% 
  group_by_at(vars(LANGUAGE, YEAR)) %>% 
  summarize(total = sum(TOTAL)) %>% 
  filter(total > 3200) %>% 
  ggplot(aes(YEAR, total)) +
  geom_line(aes(colour=LANGUAGE, group=LANGUAGE)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

DTel %>% 
  group_by_at(vars(LANGUAGE, YEAR)) %>% 
  summarize(total = sum(TOTAL)) %>% 
  filter(total > 10000) %>% 
  ggplot(aes(YEAR, total)) +
  geom_line(aes(colour=LANGUAGE, group=LANGUAGE)) +
  scale_y_log10() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

DTel %>% 
  filter(LANGUAGE == "Spanish" & YEAR == "2004") %>% 
  summarize(total = sum(TOTAL))
  
```
  
  
# Appendix
## How have the number of entries changed by year?

There are some inflated years between 2006-2008 around 75k observations and then an oddly low year in 2010 with less than 50k observations during a time when 60k observations is expected. This may skew some results. Can't help but wonder why. May be an addition/subtraction of languages. Possibly opening/closing of schools. Might they have changed the CELDT test? More on that later.

```{r}
DTel %>% 
  count(YEAR) %>% 
  ggplot(aes(YEAR, n)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  expand_limits(y=0) +
  ylab("# of observations per year")

DTel %>% 
  count(YEAR) %>% 
  ggplot(aes(YEAR, n)) +
  geom_line(group=1) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  expand_limits(y=0) +
  ylab("# of observations per year")
```
  
  