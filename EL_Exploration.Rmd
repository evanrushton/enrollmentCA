---
title: "EL Exploration"
author: "Evan Rushton"
date: "11/9/2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
setwd("~/R-projects/enrollmentCA")
EL_enrollments <- fread("./Transformed_Data/CA/el.csv", header=TRUE)
```

# How have the number of entries changed by year?

```{r}
DTel %>% 
  count(YEAR) %>% 
  ggplot(aes(YEAR, n)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  expand_limits(y=0) +
  ylab("# of observations per year")

DTel %>% 
  count(YEAR) %>% 
  ggplot(aes(YEAR, n)) +
  geom_line(group=1) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  expand_limits(y=0) +
  ylab("# of observations per year")
```

There are some inflated years between 2006-2008 around 75k observations and then an oddly low year in 2010 with less than 50k observations during a time when 60k observations is expected. This may skew some results. Can't help but wonder why. May be an addition/subtraction of languages. Possibly opening/closing of schools. More on that later.

# What are the Top Languages?
  
Clearly Spanish with over 1M speakers. Followed by Vietnamese with ~27k speakers
  
```{r}
DTel %>% 
    filter(YEAR == "2017") %>%
    group_by(LANGUAGE) %>% 
    summarize(total = sum(TOTAL)) %>% 
    mutate(LANGUAGE = fct_reorder(LANGUAGE, total)) %>% 
    arrange(desc(total)) %>% 
    head(16) %>% 
    ggplot(aes(LANGUAGE, total, na.rm=T)) +
    geom_col() +
    coord_flip() 

DTel %>% 
    filter(YEAR == "2017") %>%
    group_by(LANGUAGE) %>% 
    summarize(total = sum(TOTAL) )%>% 
    arrange(desc(total)) %>% 
    mutate(LANGUAGE = fct_reorder(LANGUAGE, total)) %>%
    mutate(LANGUAGE = fct_lump(LANGUAGE, 6))

DTel %>% 
    filter(YEAR == "2017") %>%
    group_by(LANGUAGE) %>% 
    summarize(total = sum(TOTAL)) %>% 
    filter(total > 3200) %>% 
    arrange(desc(total)) %>% 
    mutate(LANGUAGE = fct_reorder(LANGUAGE, total)) %>% 
    ggplot(aes(LANGUAGE, total, na.rm=T)) +
    geom_col() +
    coord_flip()

```

# How have Languages Changed over time?

```{r}
DTel %>% 
  group_by_at(vars(LANGUAGE, YEAR)) %>% 
  summarize(total = sum(TOTAL)) %>% 
  filter(total > 3200) %>% 
  ggplot(aes(YEAR, total)) +
  geom_line(aes(colour=LANGUAGE, group=LANGUAGE)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

DTel %>% 
  group_by_at(vars(LANGUAGE, YEAR)) %>% 
  summarize(total = sum(TOTAL)) %>% 
  filter(total > 10000) %>% 
  ggplot(aes(YEAR, total)) +
  geom_line(aes(colour=LANGUAGE, group=LANGUAGE)) +
  scale_y_log10() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```
  
  